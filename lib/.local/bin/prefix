#!/bin/sh

showHelp () {
cat << EOF

NAME
	prefix adds a dir name to the beginning of the file name

SYNOPSIS
	prefix [FILENAME] [OPTION...]

ARGUMENTS
	FILENAME - name of the file to rename
	           (ignored when -f option is provided)

OPTIONS
	-h, --help          display this help and exit
	-f, --files FILES   list of newline separated source file names to rename
	                    (when used, the FILENAME argument is ignored)

EXAMPLE

	Below command will rename the "text.txt" to "2022_01_text.txt":

	$ prefix /home/test/2022_01/test.txt

EOF
}

# Init options.
export files=''

options=$(getopt -l "help,files:" -o "hf:" -a -- "$@")
eval set -- "$options"

while true; do
	case $1 in
		-h|--help) showHelp; exit 0 ;;
		-f|--files) shift; export files="$1" ;;
		--) shift; break;;
	esac
	shift
done

# Init arguments (unless -f was provided)
if [ -z "$files" ]; then
	files="$@"
fi

# Return if no files
if [[ -z $files ]]; then
	exit 0
fi

while IFS= read -r file; do
	if [ ! -z "$file" ]; then
		r=$(realpath "$file")
		b=$(basename "$r")
		dir=$(dirname "$r")
		dirbasename=$(basename "$dir")

		mv "$r" "${dir}/${dirbasename}_${b}"
	fi

done <<< "$files"
